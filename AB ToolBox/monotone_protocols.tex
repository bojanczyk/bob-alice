% LTeX: lang=en-US

\section{Monotone Protcols}
\label{sec:monotone-protocols}
\begin{definition}
  \label{monotone_protocol_definition}
  A monotone protocol is a simple-aggregation protocol (as defined in Definition~\ref{simple-aggregation-definition}) over the monoid
  $(\Gamma^*, \cdot, \varepsilon)$
  where $\Gamma^*$ is the set of all strings over the alphabet $\Gamma$,
  $\cdot$ is the concatenation operation,
  and $\varepsilon$ is the empty string.
\end{definition}
\newcommand{\lcp}[1]{\operatorname{\bigwedge}_{#1}}

Monotone protocols are interesting because they capture a natural class of functions called rational functions that can be computed by bimachines \cite{schutzenberger1961remark} \footnote{The terminology "Bimachine" is due to Eilenberg \cite{Eilenberg74}.}. The equivalence between monotone protocols and rational functions, is a simple corollary of the Reutenauer-Sch端tzenberger Theorem \cite{reutenauer1991minimization} which we are going to explain it at beginning of this section. To do so, we define the notion of \emph{Hankel Property} for every function $f \colon \Sigma^* \to \Gamma^*$. Then we state the Reutenauer-Sch端tzenberger Theorem that every function is rational if and only if it has the Hakel Property. We are going to show that Hankel Property and monotone protocols are equivalent, i.e., every function expressed by a monotone protocol has the Hankel Property and every function that has the Hankel Property can be expressed by a monotone protocol. Therefore any function expressed by a monotone protocol is rational and vice versa. 

\label{hankel-property-and-monotone-protocols}

\begin{definition}[Hankel Property]
  A function $f \colon \Sigma^* \to \Gamma^*$ is said to have the Hankel Property if there exists a constant $K > 0$ and functions $\beta_1, \beta_2, \ldots, \beta_K \colon \Sigma^* \to \Gamma^*$ and $\gamma_1, \gamma_2, \ldots, \gamma_K \colon \Sigma^* \to \Gamma^*$ such that for every strings $u, v \in \Sigma^*$, we have:
  \[ f(uv) = \bigcup_{i=1}^{K} \beta_i(u) \cdot \gamma_i(v) \] \cite{reutenauerSchutzenberger1991}
\end{definition}
Like the original Reutenauer-Sch端tzenberger Theorem, here we consider each string, and $\emptyset$, to be embedded in the boolean semiring $2^{\Gamma^*}$, with union and prodcut as operations. Therefore, if one of the $\beta_i(u)$ or $\gamma_i(v)$ is $\emptyset$, then the corresponding term in the union is also $\emptyset$ \cite{reutenauerSchutzenberger1991}.

\begin{theorem}[Reutenauer-Sch端tzenberger Theorem]
  \label{Hankel-property-rational-function}
  Every function $f \colon \Sigma^* \to \Gamma^*$ that has the Hankel Property is rational and vice versa. \cite{reutenauerSchutzenberger1991}
\end{theorem}

So now it is enough to show that every function expressed by a monotone protocol has the Hankel Property. We will show in it the next lemma.

\begin{lemma}
  \label{monotone-protocols-hankel-property}
  Every function expressed by a monotone protocol has the Hankel Property.
\end{lemma}
\begin{proof}
  Let $(f_A,f_B,Q_A,Q_B,q_A,q_B)$ be ingredients of a monotone protocol over the monoid $(\Gamma^*, \cdot, \varepsilon)$ that expresses the function $f \colon \Sigma^* \to \Gamma^*$.
  We define functions $\beta_i \colon \Sigma^* \to \Gamma^*$ and $\gamma_i \colon \Sigma^* \to \Gamma^*$ for every $1 \leq i \leq |Q_B| \times |Q_A|$ as follows:
  \begin{itemize}
      \item $\beta_{q,p}(u) = \emptyset$ if $q_A(u) \neq q$ else $\beta_{q,p}(u) = C_A(u)[p]$
      \item $\gamma_{q,p}(v) = \emptyset$ if $q_B(v) \neq p$ else $\gamma_{q,p}(v) = C_B(v)[q]$
  \end{itemize}
  where $1 \leq q \leq |Q_B|$ and $1 \leq p \leq |Q_A|$.
  Now for every strings $u, v \in \Sigma^*$, we have:
  \[ f(uv) = \bigcup_{(q,p) \in Q_B \times Q_A} \beta_{q,p}(u) \cdot \gamma_{q,p}(v) \]
  Thus, $f$ has the Hankel Property.
\end{proof}

\newcommand{\norm}[1]{\left\lVert#1\right\rVert}

\begin{lemma}
  \label{hankel-property-monotone-protocols}
  Every function that has the Hankel Property can be expressed by a monotone protocol.
\end{lemma}

\begin{proof}

  Let $f \colon \Sigma^* \to \Gamma^*$ be a function that has the Hankel Property. Then there exists a constant $K > 0$ and functions $\beta_1, \beta_2, \ldots, \beta_K \colon \Sigma^* \to \Gamma^*$ and $\gamma_1, \gamma_2, \ldots, \gamma_K \colon \Sigma^* \to \Gamma^*$ such that for every strings $u, v \in \Sigma^*$, we have:
  \[ f(uv) = \bigcup_{i=1}^{K} \beta_i(u) \cdot \gamma_i(v) \]
  Now we define a monotone protocol $(f_A,f_B,Q_A,Q_B,q_A,q_B)$ over the monoid $(\Gamma^*, \cdot, \varepsilon)$ that expresses the function $f$ as follows:
  \begin{itemize}
      \item $Q_A = Q_B = 2^{\{1, 2, \ldots, K\}}$
      \item $q_A(u) = \{ i \mid \beta_i(u) \neq \emptyset \}$
      \item $q_B(v) = \{ i \mid \gamma_i(v) \neq \emptyset \}$
      \item $f_A(u, S_B) = \beta_i(u)$ for the unique $i \in S_B \cap q_A(u)$
      \item $f_B(v, S_A) = \gamma_i(v)$ for the unique $i \in S_A \cap q_B(v)$
  \end{itemize}
  Observe that the protcol is well-defined because the function is total and therefore for every strings $u, v \in \Sigma^*$, there exists at least one index $i$ such that $\beta_i(u) \neq \emptyset$ and $\gamma_i(v) \neq \emptyset$ and also it is not possible to have two different indices $i$ and $j$ such that $\beta_i(u) \neq \emptyset$ and $\beta_j(u) \neq \emptyset$ and $\gamma_i(v) \neq \emptyset$ and $\gamma_j(v) \neq \emptyset$ because in this case we would have two different values for $f(uv)$ which is a contradiction. Now for every strings $u, v \in \Sigma^*$, we have:
  \[ f(uv) = \bigcup_{i=1}^{K} \beta_i(u) \cdot \gamma_i(v) \]
  Thus, the monotone protocol expresses the function $f$.
  
\end{proof}

Also we have seen that expressibility by a monotone protocol is equivalent to having the Hankel Property for a function, it is not that obvious that how these two conecpts, i.e., monotone protocols and Hankel Property, are related to each other. To see this relation more clearly, we need to define notion of distance between two strings with respect to a function. For that, we introduce a notion of distance over $ \Sigma^* $ with respect to a function $ f \colon \Sigma^* \to \Gamma^* $ as follows:

\begin{definition}[Distance]
  Let $u_1, u_2 \in \Sigma^*$ be two strings. The distance between $u_1$ and $u_2$ is denoted by $\norm{u_1, u_2}$ and defined as follows:
  \[\norm{u_1, u_2} = |u_1| + |u_2| - 2 \cdot |u_1 \wedge u_2| \]
  where $u_1 \wedge u_2$ is the longest common prefix of $u_1$ and $u_2$.
\end{definition}
\medskip

Based on this notion of distance, Reutenauer and Schutzenberger define an equivalence relation, $ \RS $ by $ \forall u,v \in \Sigma^*, u \RS v $ if and only if $ \exists c(u,v) \in \mathbb N, \forall w \in \Sigma^*, \norm{f(wu),f(wv)} \le c $. This relation is the central part of their proof that functions that have the Hankel property are rational, as we will discuss later on \cite{reutenauer1991minimization}.

For now, we present an interpretation of this relation in the setting of monotone protocols. Take any monotone protocol $\pi$ with ingredients $(f_A,f_B,Q_A,Q_B,q_A,q_B)$ that expresses a function $ f \colon \Sigma^* \to \Gamma^* $.

For any two signals of Bob, $ q,q' \in Q_b $, we let $ q \Simil q' $ if and only if $\exists c \in \mathbb{N} $, such that for any $ w \in \Sigma^* $, we have $\norm{f_A[]}$.

$ \exists c(q,q'), \norm{f_A[q],f_A[q']} \le c(q,q') $.

\begin{lemma}
    Let $ u,v \in Sigma^* $, $ u \RS v $ if and only if $ q_B(u) \Simil q_B(v) $.
\end{lemma}

\begin{proof}
    We start by proving the left to right implication. Let $ u,v \in \Sigma^* $ such that $ q_B(u) \Simil q_B(v) $ and denote $ q_B(u) $ and $ q_B(v) $ by $ q $ and $ q' $ respectively. Then, there exists $ c(q,q') \in \mathbb N $ such that for any $ w \in \Sigma *, \norm{f_A[q](w),f_A[q'](w)} \le c(q,q') $. Therefore, $$ \norm{f(wu),f(wv)} \le c(q,q') + |f_B[w](u)| + |f_B[w](v)|\le c(q,q') + sup_{w \in \Sigma} |f_B[w](u)| + |f_B[w](v)|. $$

    Let $ c'(u,v) = c(q_B(u),q_B(v)) + sup_{w \in \Sigma} |f_B[w](u)| + |f_B[w](v)| $ for any $ u,v \in \Sigma^* $, for any $ w \in \Sigma^*, \norm{f(wu),f(wv)} \le c'(u,v) $ and since there are finitely many functions of the form $ f_B[w] $, $ c'(u,v) $ is finite. This concludes the proof of the first implication.
    \medskip
    
    Now, we prove the right to left implication. Let $ q,q' \in Q_B $ be two signals equivalent for $ \Simil $ and let $ P(q,q') = \lbrace (u,v) \in \Sigma^* \mid q_B(u) = q, q_B(v) = q', u \RS v \rbrace $. Now, for any $ (u,v) \in P(q,q') $, there exists $ c(u,v) \in \mathbb N $ such that $ \forall w \in \Sigma^*, \norm{f(wu),f(wv)} \le c(u,v) $. Let $ c'(q,q') = inf_{(u,v) \in P(q,q')} c(u,v) + sup_{w \in \Sigma^*} |f_B[w](u)|+|f_B[w](v)| $. Once again, there are only finitely many distinct functions $ f[w] $ for $ w \in \Sigma^* $ so the infimum is taken over natural numbers and is therefore itself a natural number. We claim that for any $ u,v \in \Sigma^* $ such that $ u \Simil v $, and for any $ w \in \Sigma^*, \norm{f_A[q_B(u)](w),f_A[q_B(v)](w)} \le c'(q_B(u),q_B(v)) $, which would conclude the proof.
   \medskip
   
   Let $ u,v \in \Sigma^* $ such that $ u \Simil v $ and let $ q = q_B(u) $ and $ q' = q_B(v) $. Assume that $ \norm{f_A[q](w),f_A[q'](w)} > c(u,v) $ then one is the prefix of the other one. Say $ f_A[q](w) $ is a prefix of $ f_A[q'](w) $. Now, $ f_A[q](w) \cdot f_B[w](u) $ and $ f_A[q'](w) $ coincide at least until the $ c(u,v) $ last letters of $ f_A[q'](w) $. As a consequence, we deduce that $ \norm{f_A[q](w),f_A[q'](w)} \le c(u,v) + |f_B[u](w)| \le c'(q,q') $. Symmetrically, if $ f_A[q'](w) $ is a prefix of $ f_A[q](w) $ then $ \norm{f_A[q](w),f_A[q'](w)} \le c(u,v) + |f_B[v](w)| \le c'(q,q') $.
\end{proof}


